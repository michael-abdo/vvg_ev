(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[402],{1826:(e,t,a)=>{"use strict";a.d(t,{FE:()=>n,KS:()=>s});var r=a(2115);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[a,s]=(0,r.useState)(null),[n,o]=(0,r.useState)(!0),[i,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let a=async()=>{try{o(!0);let a=await fetch(e);if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));let r=await a.json();t.transform&&(r=t.transform(r)),s(r),l(null)}catch(e){var a;l(e.message),null===(a=t.onError)||void 0===a||a.call(t,e)}finally{o(!1)}};!1!==t.autoLoad&&a()},[e,...t.deps||[]]),{data:a,loading:n,error:i,reload:async()=>{try{o(!0);let a=await fetch(e);if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));let r=await a.json();t.transform&&(r=t.transform(r)),s(r),l(null)}catch(e){var a;l(e.message),null===(a=t.onError)||void 0===a||a.call(t,e)}finally{o(!1)}}}}function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,a]=(0,r.useState)(!1),[s,n]=(0,r.useState)(null),[o,i]=(0,r.useState)(null);return{execute:async t=>{var r,s;try{a(!0),n(null);let s=await t();return i(s),null===(r=e.onSuccess)||void 0===r||r.call(e,s),s}catch(t){throw n(t.message||"An error occurred"),null===(s=e.onError)||void 0===s||s.call(e,t),t}finally{a(!1)}},loading:t,error:s,data:o,reset:()=>{i(null),n(null),a(!1)}}}},2952:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>k});var r=a(5155),s=a(2115),n=a(4740),o=a(646),i=a(4186),l=a(5339),c=a(8564),d=a(7434),u=a(2138),m=a(8840),h=a(8102),g=a(7358);let p={resolved:function(){let e=function(e){if(!e||""===e||"/"===e)return"";let t=e.trim();return t.startsWith("/")||(t="/".concat(t)),t.endsWith("/")&&t.length>1&&(t=t.slice(0,-1)),t}(g.env.BASE_PATH||"/template-staging");return!function(e){if(""!==e){if(!e.startsWith("/"))throw Error("BasePath must start with '/'. Got: ".concat(e));if(e.endsWith("/"))throw Error("BasePath must NOT end with '/'. Got: ".concat(e));if(/[^a-zA-Z0-9\-_\/]/.test(e))throw Error("BasePath contains invalid characters. Use only: a-z, A-Z, 0-9, -, _, /. Got: ".concat(e));if(e.includes("//"))throw Error("BasePath cannot contain double slashes. Got: ".concat(e));if(e.length>100)throw Error("BasePath too long (max 100 chars). Got: ".concat(e.length," chars"))}}(e),""===e&&console.warn("⚠️ [BasePath] Production running at root path (no basePath)"),e}(),utilities:null};p.utilities=function(e){return{basePath:e,buildPagePath:t=>{if(t.startsWith("http"))return t;let a=t.startsWith("/")?t:"/".concat(t);return"".concat(e).concat(a)},buildApiPath:t=>{if(t.startsWith("http"))return t;let a=t.startsWith("/api/")?t:"/api/".concat(t.replace(/^\//,""));return"".concat(e).concat(a)},buildAssetPath:t=>{if(t.startsWith("http"))return t;let a=t.startsWith("/")?t:"/".concat(t);return"".concat(e).concat(a)},stripBasePath:t=>e&&t.startsWith(e)?t.slice(e.length)||"/":t}}(p.resolved),p.resolved;var E=a(7358);let S={AZURE_AD_CLIENT_ID:E.env.AZURE_AD_CLIENT_ID||"",AZURE_AD_CLIENT_SECRET:E.env.AZURE_AD_CLIENT_SECRET||"",AZURE_AD_TENANT_ID:E.env.AZURE_AD_TENANT_ID||"",NEXTAUTH_URL:E.env.NEXTAUTH_URL||"http://localhost:".concat(E.env.PORT),NEXTAUTH_SECRET:E.env.NEXTAUTH_SECRET||"fallback-secret-for-build",BASE_PATH:p.resolved,DB_TABLE_PREFIX:E.env.DB_TABLE_PREFIX||"",NODE_ENV:"production",OPENAI_API_KEY:E.env.OPENAI_API_KEY||"",QUEUE_SYSTEM_TOKEN:E.env.QUEUE_SYSTEM_TOKEN||"development-queue-token",IS_DEVELOPMENT:!1,IS_PRODUCTION:!0,MYSQL_HOST:E.env.MYSQL_HOST||"localhost",MYSQL_PORT:E.env.MYSQL_PORT||"3306",MYSQL_USER:E.env.MYSQL_USER||"root",MYSQL_PASSWORD:E.env.MYSQL_PASSWORD||"",MYSQL_DATABASE:E.env.MYSQL_DATABASE||"vvg_template",DATABASE_URL:E.env.DATABASE_URL||"",STORAGE_PROVIDER:E.env.STORAGE_PROVIDER||"local",AWS_ACCESS_KEY_ID:E.env.AWS_ACCESS_KEY_ID||"",AWS_SECRET_ACCESS_KEY:E.env.AWS_SECRET_ACCESS_KEY||"",AWS_REGION:E.env.AWS_REGION||"us-west-2",S3_BUCKET_NAME:E.env.S3_BUCKET_NAME||"vvg-template-shared-bucket",S3_FOLDER_PREFIX:E.env.S3_FOLDER_PREFIX||"documents/",S3_ACCESS:"true"===E.env.S3_ACCESS,app:{name:E.env.PROJECT_NAME||"vvg-template",email:E.env.SES_FROM_EMAIL||"noreply@example.com"},email:{smtp:{host:E.env.AWS_SES_SMTP_HOST||"email-smtp.".concat(E.env.AWS_REGION||"us-east-1",".amazonaws.com"),port:parseInt(E.env.AWS_SES_SMTP_PORT||"587",10),username:E.env.AWS_SES_SMTP_USERNAME||"",password:E.env.AWS_SES_SMTP_PASSWORD||""},from:E.env.SES_FROM_EMAIL||"noreply@example.com",testRecipient:E.env.SES_TEST_RECIPIENT||"",adminEmail:E.env.ADMIN_EMAIL||"",enableInDev:"true"===E.env.ENABLE_EMAIL_IN_DEV}},f={isDevelopment:()=>"development"===S.NODE_ENV,isProduction:()=>"production"===S.NODE_ENV,isTest:()=>"test"===S.NODE_ENV,isStaging:()=>"staging"===S.NODE_ENV,requireDevelopment:()=>{if(f.isProduction())throw Error("Development-only feature accessed in production")},devOnlyResponse:()=>f.isProduction()?new Response(null,{status:404}):null,hasDbAccess:()=>!!(S.DATABASE_URL||S.MYSQL_HOST&&S.MYSQL_DATABASE)},v={DEV_BYPASS:"false"!==E.env.FEATURE_DEV_BYPASS,devBypass:"false"!==E.env.FEATURE_DEV_BYPASS};({...S,basePath:{resolved:p.resolved,utilities:p.utilities}});let _={FILE_LIMITS:{ALLOWED_MIME_TYPES:["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword","text/plain","text/csv"],ALLOWED_EXTENSIONS:[".pdf",".docx",".doc",".txt",".csv"],MAX_SIZE:0xa00000}};S.NODE_ENV,f.isDevelopment(),f.isProduction(),E.env.QUEUE_SYSTEM_TOKEN;var y=function(e){return e.UPLOADED="uploaded",e.PROCESSING="processing",e.PROCESSED="processed",e.ERROR="error",e}({}),x=function(e){return e.PENDING="pending",e.PROCESSING="processing",e.COMPLETED="completed",e.ERROR="error",e}({});y.UPLOADED,y.PROCESSING,y.ERROR,y.PROCESSING,y.PROCESSED,y.ERROR,y.PROCESSED,y.ERROR,y.PROCESSING,x.PENDING,x.PROCESSING,x.ERROR,x.PROCESSING,x.COMPLETED,x.ERROR,x.COMPLETED,x.ERROR,x.PROCESSING;class N{elapsed(){return Date.now()-this.startTime}elapsedFormatted(){return this.formatDuration(this.elapsed())}end(){let e=Date.now(),t=e-this.startTime;return{startTime:new Date(this.startTime),endTime:new Date(e),duration:t,durationMs:t,durationFormatted:this.formatDuration(t),operationName:this.operationName}}endWithLog(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.end(),{logger:a,threshold:r=0,level:s="log"}=e;if(t.duration>=r){let e="".concat(this.operationName," completed in ").concat(t.durationFormatted),r={duration:t.duration,startTime:t.startTime.toISOString(),endTime:t.endTime.toISOString(),...this.metadata};a?a[s](e,r):console[s]("[PERFORMANCE] ".concat(e),r)}return t}formatDuration(e){return e<1e3?"".concat(e,"ms"):e<6e4?"".concat((e/1e3).toFixed(2),"s"):e<36e5?"".concat((e/6e4).toFixed(2),"m"):"".concat((e/36e5).toFixed(2),"h")}constructor(e,t={}){this.startTime=Date.now(),this.operationName=e,this.metadata=t}}let R={isFileNotFoundError(e){var t;return(null==e?void 0:e.code)==="ENOENT"||(null==e?void 0:e.code)==="NoSuchKey"||(null==e?void 0:null===(t=e.message)||void 0===t?void 0:t.includes("not found"))||(null==e?void 0:e.statusCode)===404},isDatabaseConnectionError(e){var t;return(null==e?void 0:e.code)==="ECONNREFUSED"||(null==e?void 0:e.code)==="ER_CON_COUNT_ERROR"||(null==e?void 0:null===(t=e.message)||void 0===t?void 0:t.includes("connection refused"))},isDuplicateError(e){var t;return(null==e?void 0:e.code)==="ER_DUP_ENTRY"||(null==e?void 0:e.code)==="23505"||(null==e?void 0:null===(t=e.message)||void 0===t?void 0:t.includes("duplicate"))},getErrorCategory(e){var t;return this.isFileNotFoundError(e)?"not_found":this.isDatabaseConnectionError(e)?"connection":this.isDuplicateError(e)?"duplicate":(null==e?void 0:e.code)==="AccessDenied"||(null==e?void 0:e.code)==="Forbidden"?"permission":(null==e?void 0:null===(t=e.code)||void 0===t?void 0:t.startsWith("ER_"))||(null==e?void 0:e.name)==="ValidationError"?"validation":"unknown"},getErrorSuggestion(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.code||e.Code||"UNKNOWN_ERROR",s=e.statusCode||(null===(t=e.$metadata)||void 0===t?void 0:t.httpStatusCode);switch(r){case"NoSuchBucket":return{userMessage:"Storage bucket not found",errorCode:"STORAGE_BUCKET_NOT_FOUND",isRetryable:!1,suggestion:"Please check your storage configuration and bucket name."};case"AccessDenied":case"Forbidden":return{userMessage:"Storage access denied",errorCode:"STORAGE_ACCESS_DENIED",isRetryable:!1,suggestion:"Please check your storage credentials and bucket permissions."};case"NoSuchKey":return{userMessage:a.resource?"File '".concat(a.resource,"' not found in storage"):"File not found in storage",errorCode:"STORAGE_FILE_NOT_FOUND",isRetryable:!1,suggestion:"The requested file may have been moved or deleted."};case"InvalidBucketName":return{userMessage:"Invalid storage bucket name",errorCode:"STORAGE_INVALID_BUCKET",isRetryable:!1,suggestion:"Please check your storage configuration for valid bucket naming."};case"SlowDown":case"RequestLimitExceeded":case"TooManyRequests":return{userMessage:"Storage service is being throttled",errorCode:"STORAGE_THROTTLED",isRetryable:!0,suggestion:"Please wait a moment and try again. The service is experiencing high load."};case"ServiceUnavailable":return{userMessage:"Storage service temporarily unavailable",errorCode:"STORAGE_SERVICE_UNAVAILABLE",isRetryable:!0,suggestion:"The storage service is temporarily down. Please try again in a few minutes."};case"RequestTimeout":return{userMessage:"Storage operation timed out",errorCode:"STORAGE_TIMEOUT",isRetryable:!0,suggestion:"The operation took too long to complete. Please try again."};case"ENOSPC":return{userMessage:"Insufficient storage space",errorCode:"STORAGE_QUOTA_EXCEEDED",isRetryable:!1,suggestion:"Please free up storage space or contact your administrator."};case"ENOENT":return{userMessage:"File or directory not found",errorCode:"STORAGE_PATH_NOT_FOUND",isRetryable:!1,suggestion:"The file path may be incorrect or the file may have been moved."};case"ECONNREFUSED":return{userMessage:"Cannot connect to storage service",errorCode:"STORAGE_CONNECTION_REFUSED",isRetryable:!0,suggestion:"Please check your network connection and storage service configuration."};case"ETIMEDOUT":return{userMessage:"Connection to storage service timed out",errorCode:"STORAGE_CONNECTION_TIMEOUT",isRetryable:!0,suggestion:"Please check your network connection and try again."};case"ENOTFOUND":return{userMessage:"Storage service not found",errorCode:"STORAGE_SERVICE_NOT_FOUND",isRetryable:!0,suggestion:"Please check your storage service configuration and DNS settings."};default:if(s){if(s>=500&&s<600)return{userMessage:"Storage service error",errorCode:"STORAGE_SERVER_ERROR",isRetryable:!0,suggestion:"A server error occurred. Please try again in a few moments."};if(s>=400&&s<500)return{userMessage:"Storage request error",errorCode:"STORAGE_CLIENT_ERROR",isRetryable:!1,suggestion:"Please check your request parameters and try again."}}return{userMessage:a.operation?"".concat(a.operation," operation failed"):"Storage operation failed",errorCode:"STORAGE_UNKNOWN_ERROR",isRetryable:!1,suggestion:"An unexpected error occurred. Please try again or contact support."}}},isRetryableError(e){return this.getErrorSuggestion(e).isRetryable},getUserMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getErrorSuggestion(e,t).userMessage},getErrorCode(e){return this.getErrorSuggestion(e).errorCode},getSuggestion(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getErrorSuggestion(e,t).suggestion}},w={storage:{maxAttempts:3,initialDelay:1e3,maxDelay:1e4,backoffFactor:2,jitter:!0,timeout:3e4},api:{maxAttempts:3,initialDelay:500,maxDelay:5e3,backoffFactor:2,jitter:!0,timeout:15e3},database:{maxAttempts:5,initialDelay:100,maxDelay:2e3,backoffFactor:1.5,jitter:!1,timeout:1e4},queue:{maxAttempts:3,initialDelay:2e3,maxDelay:3e4,backoffFactor:2,jitter:!0,timeout:6e4},network:{maxAttempts:5,initialDelay:1e3,maxDelay:8e3,backoffFactor:2,jitter:!0,timeout:2e4}};class T{canExecute(){return"closed"===this.state||"open"!==this.state||Date.now()-this.lastFailureTime>this.recoveryTimeout&&(this.state="half-open",!0)}onSuccess(){this.failures=0,this.state="closed"}onFailure(){this.failures++,this.lastFailureTime=Date.now(),this.failures>=this.failureThreshold&&(this.state="open")}getState(){return this.state}constructor(e=5,t=6e4){this.failureThreshold=e,this.recoveryTimeout=t,this.failures=0,this.lastFailureTime=0,this.state="closed"}}class D{static async withRetry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{maxAttempts:a=3,initialDelay:r=1e3,maxDelay:s=1e4,backoffFactor:n=2,jitter:o=!0,timeout:i,retryCondition:l=this.defaultRetryCondition,onRetry:c,onFailure:d,abortSignal:u}=t,m=new N("retry-operation"),h=[],g=0;for(;g<a;){g++;try{if(null==u?void 0:u.aborted)throw Error("Operation aborted");let t=i?await this.withTimeout(e(),i):await e(),a=m.end();return{result:t,attempts:g,totalDuration:a.duration,errors:h,wasRetried:g>1}}catch(u){let e=u instanceof Error?u:Error(String(u));if(h.push(e),g>=a||!l(e,g)){let t=m.end();throw d&&d(e,g,t.duration),Error("Operation failed after ".concat(g," attempts in ").concat(t.durationFormatted,". Last error: ").concat(e.message))}let t=Math.min(r*Math.pow(n,g-1),s),i=o?t+Math.random()*t*.1:t;c&&c(e,g,i),await this.delay(i)}}throw Error("Unexpected retry loop exit")}static defaultRetryCondition(e,t){return R.isRetryableError(e)}static async withCircuitBreaker(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.getCircuitBreaker(t);if(!r.canExecute())throw Error("Circuit breaker is open for ".concat(t));try{let t=await this.withRetry(e,a);return r.onSuccess(),t}catch(e){throw r.onFailure(),e}}static getCircuitBreaker(e){return this.circuitBreakers.has(e)||this.circuitBreakers.set(e,new T),this.circuitBreakers.get(e)}static async forStorage(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.withRetry(e,{...w.storage,...a,onRetry:(e,r,s)=>{var n;console.log("Storage ".concat(t," failed (attempt ").concat(r,"), retrying in ").concat(s,"ms:"),e.message),null===(n=a.onRetry)||void 0===n||n.call(a,e,r,s)},onFailure:(e,r,s)=>{var n;console.error("Storage ".concat(t," failed permanently after ").concat(r," attempts in ").concat(s,"ms:"),e),null===(n=a.onFailure)||void 0===n||n.call(a,e,r,s)}})}static async forApi(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.withRetry(e,{...w.api,...a,retryCondition:(e,t)=>e.status>=400&&e.status<500?408===e.status||429===e.status:this.defaultRetryCondition(e,t),onRetry:(e,r,s)=>{var n;console.log("API ".concat(t," failed (attempt ").concat(r,"), retrying in ").concat(s,"ms:"),e.message),null===(n=a.onRetry)||void 0===n||n.call(a,e,r,s)}})}static async forDatabase(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.withRetry(e,{...w.database,...a,retryCondition:(e,t)=>{var a;let r=(null===(a=e.message)||void 0===a?void 0:a.toLowerCase())||"";return!!(r.includes("connection")||r.includes("timeout")||r.includes("deadlock"))||this.defaultRetryCondition(e,t)},onRetry:(e,r,s)=>{var n;console.log("Database ".concat(t," failed (attempt ").concat(r,"), retrying in ").concat(s,"ms:"),e.message),null===(n=a.onRetry)||void 0===n||n.call(a,e,r,s)}})}static async forQueue(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.withRetry(e,{...w.queue,...a,onRetry:(e,r,s)=>{var n;console.log("Queue ".concat(t," failed (attempt ").concat(r,"), retrying in ").concat(s,"ms:"),e.message),null===(n=a.onRetry)||void 0===n||n.call(a,e,r,s)}})}static async withConfig(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.withRetry(e,{...w[t],...a})}static withTimeout(e,t){return new Promise((a,r)=>{let s=setTimeout(()=>{r(Error("Operation timed out after ".concat(t,"ms")))},t);e.then(a).catch(r).finally(()=>clearTimeout(s))})}static delay(e){return new Promise(t=>setTimeout(t,e))}static async retryAll(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Promise.all(e.map(e=>this.withRetry(e,t)))}static async withRateLimit(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.withRetry(e,{...a,retryCondition:(e,t)=>{var r,s,n;return(null===(r=e.message)||void 0===r?void 0:r.includes("rate limit"))?t<(a.maxAttempts||5):null!==(n=null===(s=a.retryCondition)||void 0===s?void 0:s.call(a,e,t))&&void 0!==n?n:this.defaultRetryCondition(e,t)}})}static getCircuitBreakerStatus(e){let t=this.circuitBreakers.get(e);return(null==t?void 0:t.getState())||"unknown"}static resetCircuitBreaker(e){this.circuitBreakers.delete(e)}static getAllCircuitBreakerStatuses(){let e={};for(let[t,a]of this.circuitBreakers)e[t]=a.getState();return e}}D.circuitBreakers=new Map;class A{static sanitize(e){let t=M.getMessage(e),a=M.getCode(e);return{message:t.replace(/password[=:]\s*[^\s]+/gi,"password=***").replace(/token[=:]\s*[^\s]+/gi,"token=***").replace(/key[=:]\s*[^\s]+/gi,"key=***"),code:a,timestamp:P.now(),sanitized:!0}}static toUserMessage(e){return M.isError(e)?"An error occurred. Please try again.":"An unexpected error occurred."}static normalizeError(e){return M.isError(e)?e:Error("string"==typeof e?e:"Unknown error")}}A.sanitize,A.normalizeError,A.toUserMessage,a(4134).hp;class C{static convertBaseRow(e){return{...e,created_at:"string"==typeof e.created_at?new Date(e.created_at):e.created_at,updated_at:"string"==typeof e.updated_at?new Date(e.updated_at):e.updated_at}}static convertDocument(e){return{...C.convertBaseRow(e),metadata:L.parseMetadata(e.metadata),file_size:Number(e.file_size),is_standard:!!e.is_standard}}static convertComparison(e){return{...C.convertBaseRow(e),metadata:L.parseMetadata(e.metadata),differences:L.parseMetadata(e.differences),risk_score:Number(e.risk_score),document_id:Number(e.document_id),standard_id:e.standard_id?Number(e.standard_id):null}}static convertExport(e){return{...C.convertBaseRow(e),metadata:L.parseMetadata(e.metadata),comparison_id:Number(e.comparison_id)}}static convertQueue(e){return{...C.convertBaseRow(e),metadata:L.parseMetadata(e.metadata),document_id:Number(e.document_id),priority:Number(e.priority),attempts:Number(e.attempts),max_attempts:Number(e.max_attempts),scheduled_at:e.scheduled_at?"string"==typeof e.scheduled_at?new Date(e.scheduled_at):e.scheduled_at:null,started_at:e.started_at?"string"==typeof e.started_at?new Date(e.started_at):e.started_at:null,completed_at:e.completed_at?"string"==typeof e.completed_at?new Date(e.completed_at):e.completed_at:null,failed_at:e.failed_at?"string"==typeof e.failed_at?new Date(e.failed_at):e.failed_at:null}}}C.convertDocument,C.convertComparison,C.convertExport,C.convertQueue,(e,t)=>e.map(t);let O={badRequest:e=>h.NextResponse.json({error:e},{status:400}),validation:(e,t)=>h.NextResponse.json({error:e,details:t},{status:422})},b={getFilenameFromPath:e=>e.split("/").pop()||e,getFileExtension:e=>e.toLowerCase().split(".").pop()||"",getFileType:e=>b.getFileExtension(e)||"unknown",containsIgnoreCase:(e,t)=>e.toLowerCase().includes(t.toLowerCase()),normalize:e=>e.toLowerCase().trim(),formatFileSize:e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},formatDate:e=>new Date(e).toLocaleDateString(),getTextStats:e=>{if(!e)return{length:0,words:0,lines:0,paragraphs:0,isEmpty:!0,hasContent:!1};let t=e.trim(),a=t.split(/\s+/).filter(e=>e.length>0),r=t.split("\n").filter(e=>e.trim().length>0),s=t.split(/\n\n+/).filter(e=>e.trim().length>0);return{length:e.length,words:a.length,lines:r.length,paragraphs:s.length,isEmpty:0===t.length,hasContent:t.length>0}},truncate:function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return!e||e.length<=t?e:e.substring(0,t-a.length).trim()+a},extractPreview:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;if(!e)return"";let a=e.replace(/\s+/g," ").trim();return b.truncate(a,t)},calculateSimilarity:(e,t)=>{if(!e||!t)return 0;let a=new Set(e.toLowerCase().split(/\s+/)),r=new Set(t.toLowerCase().split(/\s+/)),s=new Set([...a].filter(e=>r.has(e))),n=new Set([...a,...r]);return n.size>0?s.size/n.size:0}},M={isError:e=>e instanceof Error||e&&"object"==typeof e&&"message"in e&&"name"in e,getMessage:e=>"string"==typeof e?e:M.isError(e)?e.message:(null==e?void 0:e.error)?M.getMessage(e.error):(null==e?void 0:e.message)?e.message:"Unknown error occurred",getCode:e=>(null==e?void 0:e.code)||(null==e?void 0:e.errorCode)||(null==e?void 0:e.error_code),withContext:(e,t)=>{let a=Error(e);return Object.assign(a,{context:t}),a},isType:(e,t)=>{var a;return(null==e?void 0:e.name)===t||(null==e?void 0:null===(a=e.constructor)||void 0===a?void 0:a.name)===t},is:{networkError:e=>{let t=M.getMessage(e).toLowerCase();return t.includes("network")||t.includes("fetch")||t.includes("connection")},validationError:e=>{let t=M.getMessage(e).toLowerCase();return t.includes("validation")||t.includes("invalid")||(null==e?void 0:e.statusCode)===422},authError:e=>{let t=M.getMessage(e).toLowerCase();return t.includes("unauthorized")||t.includes("authentication")||(null==e?void 0:e.statusCode)===401},notFoundError:e=>M.getMessage(e).toLowerCase().includes("not found")||(null==e?void 0:e.statusCode)===404}};function j(e){return b.getFilenameFromPath(e)}let I={allowedTypes:[..._.FILE_LIMITS.ALLOWED_MIME_TYPES],allowedExtensions:_.FILE_LIMITS.ALLOWED_EXTENSIONS,maxSize:_.FILE_LIMITS.MAX_SIZE,extensionToMimeType:{".pdf":"application/pdf",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".doc":"application/msword",".txt":"text/plain",".csv":"text/csv"},validateFile:e=>{if(!I.allowedTypes.includes(e.type))throw Error("Invalid file type. Only ".concat(I.allowedExtensions.join(", ").toUpperCase()," files are allowed. Received: ").concat(e.type));if(e.size>I.maxSize)throw Error("File too large. Maximum size is ".concat(I.maxSize/1024/1024,"MB. Received: ").concat((e.size/1024/1024).toFixed(2),"MB"));return!0},getValidationError:e=>{try{return I.validateFile(e),null}catch(t){if(t.message.includes("Invalid file type"))return O.validation("Invalid file type",{allowedTypes:I.allowedExtensions,receivedType:e.type});if(t.message.includes("File too large"))return O.validation("File too large",{maxSize:I.maxSize,actualSize:e.size,maxSizeMB:I.maxSize/1024/1024,actualSizeMB:Number((e.size/1024/1024).toFixed(2))});return O.badRequest(t.message)}},getContentType:e=>{let t=e.toLowerCase().split(".").pop()||"";return I.extensionToMimeType[t]||"application/octet-stream"}},P={now:()=>new Date().toISOString(),nowUTC:()=>new Date().toISOString(),formatForDB:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return e.toISOString()},formatForLog:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return e.toISOString()},formatForAPI:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return e.toISOString()},createTimestamp:()=>({createdAt:P.now()}),updateTimestamp:()=>({updatedAt:P.now()}),auditTimestamp:()=>({createdAt:P.now(),updatedAt:P.now()}),withMetadata:e=>({timestamp:P.now(),...e}),parse:e=>e instanceof Date?e:new Date(e),isRecent:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,a=P.parse(e);return(new Date().getTime()-a.getTime())/6e4<=t},formatHuman:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US";return e.toLocaleString(t)},toLocaleDateString:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US";return new Date(e).toLocaleDateString(t,{year:"numeric",month:"short",day:"numeric"})},toLocaleString:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US";return new Date(e).toLocaleString(t)},fromNow:e=>{let t=Math.floor((Date.now()-new Date(e).getTime())/864e5);return 0===t?"Today":1===t?"Yesterday":t<7?"".concat(t," days ago"):t<30?"".concat(Math.floor(t/7)," weeks ago"):P.toLocaleDateString(e)},isExpired:e=>new Date(e).getTime()<Date.now(),formatForFilename:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return e.toISOString().replace(/[:.]/g,"-").split(".")[0]},duration:{seconds:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,a=P.parse(e);return Math.floor((P.parse(t).getTime()-a.getTime())/1e3)},minutes:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;return Math.floor(P.duration.seconds(e,t)/60)},milliseconds:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,a=P.parse(e);return P.parse(t).getTime()-a.getTime()},humanReadable:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,a=P.duration.milliseconds(e,t);return a<1e3?"".concat(a,"ms"):a<6e4?"".concat((a/1e3).toFixed(1),"s"):a<36e5?"".concat((a/6e4).toFixed(1),"m"):"".concat((a/36e5).toFixed(1),"h")}},relative:{from:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,a=P.parse(e),r=t.getTime()-a.getTime();return r<6e4?"just now":r<36e5?"".concat(Math.floor(r/6e4)," minutes ago"):r<864e5?"".concat(Math.floor(r/36e5)," hours ago"):r<6048e5?"".concat(Math.floor(r/864e5)," days ago"):a.toLocaleDateString()},to:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,a=P.parse(e),r=a.getTime()-t.getTime();return r<0?P.relative.from(e,t):r<6e4?"in a moment":r<36e5?"in ".concat(Math.floor(r/6e4)," minutes"):r<864e5?"in ".concat(Math.floor(r/36e5)," hours"):r<6048e5?"in ".concat(Math.floor(r/864e5)," days"):a.toLocaleDateString()}}},L={safeParse:(e,t)=>{if(!e)return t;try{return JSON.parse(e)}catch(e){return t}},parseMetadata:e=>e?"string"==typeof e?L.safeParse(e,{}):e:{},mergeMetadata:(e,t)=>({...L.parseMetadata(e),...t,lastUpdated:new Date().toISOString()}),stringify:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{return t?JSON.stringify(e,null,2):JSON.stringify(e)}catch(e){return console.error("JSON stringify error:",e),"{}"}},deepClone:e=>JSON.parse(JSON.stringify(e)),isValidJson:e=>{try{return JSON.parse(e),!0}catch(e){return!1}},extractFields:(e,t)=>{let a=L.parseMetadata(e),r={};return t.forEach(e=>{e in a&&(r[e]=a[e])}),r},metadata:{withTimestamp:e=>({...e,timestamp:new Date().toISOString()}),withUser:(e,t)=>({...e,userEmail:t,updatedBy:t,updatedAt:new Date().toISOString()}),withError:(e,t)=>({...e,error:{message:t.message,name:t.name,timestamp:new Date().toISOString()}})},getNestedValue:(e,t,a)=>{if(!e)return a;let r=t.split("."),s=e;for(let e of r){if((null==s?void 0:s[e])===void 0)return a;s=s[e]}return s},getExtractionMetadata:e=>({pages:L.getNestedValue(e,"extraction.pages",null),confidence:L.getNestedValue(e,"extraction.confidence",null),method:L.getNestedValue(e,"extraction.method","unknown"),extractedAt:L.getNestedValue(e,"extraction.extractedAt",null)})};var F=a(1826);function k(){let[e,t]=(0,s.useState)(""),[a,h]=(0,s.useState)(""),[g,p]=(0,s.useState)(null),[E,S]=(0,s.useState)([]),{data:f=[]}=(0,F.KS)("/api/documents",{autoLoad:!1,transform:e=>e.data||[],deps:[]}),{execute:v,loading:_}=(0,F.FE)({onSuccess:e=>{p(e.data),S(t=>[e.data,...t.slice(0,4)])},onError:e=>{alert("Comparison failed: ".concat(e.message))}}),y=(e,t)=>v(async()=>{let a=await fetch("/api/compare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({standardDocId:e,thirdPartyDocId:t})});if(!a.ok)throw Error((await a.json()).message||"Comparison failed");return a.json()}),x=async()=>{e&&a&&(p(null),await y(e,a))},N=(null==f?void 0:f.filter(e=>e.is_standard))||[],R=(null==f?void 0:f.filter(e=>!e.is_standard))||[],w=e=>{switch(e){case"low":return"text-green-600 bg-green-50 border-green-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"high":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};return(0,r.jsxs)(m.L,{className:"space-y-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Compare Documents"}),(0,r.jsxs)(n.Zp,{children:[(0,r.jsx)(n.aR,{children:(0,r.jsx)(n.ZB,{children:"Select Documents to Compare"})}),(0,r.jsxs)(n.Wu,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Standard Template"}),(0,r.jsxs)(n.l6,{value:e,onValueChange:t,children:[(0,r.jsx)(n.bq,{children:(0,r.jsx)(n.yv,{placeholder:"Choose your standard document template"})}),(0,r.jsx)(n.gC,{children:N.map(e=>(0,r.jsx)(n.eb,{value:e.id.toString(),children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(c.A,{className:"h-3 w-3 text-yellow-500"}),j(e.filename)]})},e.id))})]}),0===N.length&&(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"No standard templates found. Upload a document and mark it as standard in the Documents page."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Third-Party Document"}),(0,r.jsxs)(n.l6,{value:a,onValueChange:h,children:[(0,r.jsx)(n.bq,{children:(0,r.jsx)(n.yv,{placeholder:"Choose third-party document to analyze"})}),(0,r.jsx)(n.gC,{children:R.map(e=>(0,r.jsx)(n.eb,{value:e.id.toString(),children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(d.A,{className:"h-3 w-3"}),j(e.filename)]})},e.id))})]}),0===R.length&&(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"No third-party documents found. Upload some documents to compare."})]})]}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(n.$n,{onClick:x,disabled:!e||!a||_,size:"lg",className:"px-8",children:_?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Analyzing Documents..."]}):(0,r.jsxs)(r.Fragment,{children:["Compare Documents",(0,r.jsx)(u.A,{className:"ml-2 h-4 w-4"})]})})})]})]}),g&&(0,r.jsxs)(n.Zp,{children:[(0,r.jsx)(n.aR,{children:(0,r.jsxs)(n.ZB,{className:"flex items-center gap-2",children:["Comparison Results",(0,r.jsxs)(n.Ex,{className:w("medium"),children:[(e=>{switch(e){case"low":return(0,r.jsx)(o.A,{className:"h-4 w-4"});case"medium":default:return(0,r.jsx)(i.A,{className:"h-4 w-4"});case"high":return(0,r.jsx)(l.A,{className:"h-4 w-4"})}})("medium"),"MEDIUM RISK"]})]})}),(0,r.jsxs)(n.Wu,{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Executive Summary"}),(0,r.jsx)("p",{className:"text-gray-700",children:"Comparison complete. Review the differences and recommendations below."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Key Differences"}),(0,r.jsx)("ul",{className:"space-y-1",children:g.result.differences.map((e,t)=>(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)(l.A,{className:"h-4 w-4 text-amber-500 mt-0.5 flex-shrink-0"}),(0,r.jsx)("span",{className:"text-sm",children:e.description})]},t))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-3",children:"Detailed Analysis by Section"}),(0,r.jsx)("div",{className:"space-y-4",children:g.result.actions.slice(0,3).map((e,t)=>(0,r.jsxs)(n.Zp,{className:"border-l-4 border-l-blue-500",children:[(0,r.jsx)(n.aR,{className:"pb-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(n.ZB,{className:"text-lg",children:e.type}),(0,r.jsx)(n.Ex,{className:w("medium"),children:"MEDIUM"})]})}),(0,r.jsx)(n.Wu,{className:"space-y-3",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-sm mb-2",children:"Action:"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]})})]},t))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Recommended Actions"}),(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsx)("ul",{className:"space-y-2",children:g.result.actions.map((e,t)=>(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)(o.A,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),(0,r.jsx)("span",{className:"text-sm text-blue-800",children:e.description})]},t))})})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t",children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Analysis Confidence: 85%"}),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["Completed: ",new Date(g.created_at).toLocaleString()]})]})]})]}),E.length>0&&(0,r.jsxs)(n.Zp,{children:[(0,r.jsx)(n.aR,{children:(0,r.jsx)(n.ZB,{children:"Recent Comparisons"})}),(0,r.jsx)(n.Wu,{children:(0,r.jsx)("div",{className:"space-y-3",children:E.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>p(e),children:[(0,r.jsx)("div",{className:"flex items-center gap-3",children:(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsxs)("span",{className:"font-medium",children:["Document ",e.standard_doc_id]}),(0,r.jsx)("span",{className:"text-gray-500 mx-2",children:"vs"}),(0,r.jsxs)("span",{className:"font-medium",children:["Document ",e.third_party_doc_id]})]})}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(n.Ex,{className:w("medium"),children:"MEDIUM"}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString()})]})]},t))})})]})]})}},8840:(e,t,a)=>{"use strict";a.d(t,{L:()=>n});var r=a(5155),s=a(7052);function n(e){let{children:t,className:a}=e;return(0,r.jsx)("main",{className:(0,s.cn)("container mx-auto p-8",a),children:t})}},8841:(e,t,a)=>{Promise.resolve().then(a.bind(a,2952))}},e=>{var t=t=>e(e.s=t);e.O(0,[241,699,473,740,441,684,358],()=>t(8841)),_N_E=e.O()}]);