"use strict";exports.id=7718,exports.ids=[7718],exports.modules={2591:(e,t,r)=>{r.d(t,{V:()=>s});var a=r(81571);let s={api:{start:(e,t,r)=>{console.log(`🔍 [${e.toUpperCase()}] Endpoint called`),console.log(`🔍 [${e.toUpperCase()}] User: ${t}`),r&&Object.entries(r).forEach(([t,r])=>{console.log(`🔍 [${e.toUpperCase()}] ${t}:`,r)})},success:(e,t,r)=>{console.log(`✅ [${e.toUpperCase()}] ${t}`),r&&console.log(`✅ [${e.toUpperCase()}] Details:`,r)},error:(e,t,r)=>{console.log(`❌ [${e.toUpperCase()}] ${t}`),r&&console.error(`❌ [${e.toUpperCase()}] Error:`,r.message)},step:(e,t,r)=>{console.log(`🔍 [${e.toUpperCase()}] ${t}`),r&&console.log(`🔍 [${e.toUpperCase()}] ${t} details:`,r)},warn:(e,t,r)=>{console.warn(`⚠️  [${e.toUpperCase()}] ${t}`),r&&console.warn(`⚠️  [${e.toUpperCase()}] Details:`,r)}},db:{operation:(e,t)=>{console.log(`🗄️ [DB] ${e}`),t&&console.log(`🗄️ [DB] Details:`,t)},found:(e,t,r)=>{let a=r?.userEmail?` for ${r.userEmail}`:"";console.log(`🔍 [DB] Found ${t} ${e}${a}`)},missing:(e,t)=>{let r=t?.userEmail?` for ${t.userEmail}`:"";console.log(`❌ [DB] ${e} not found${r}`)},error:(e,t)=>{console.error(`❌ [DB] ${e}`),t&&console.error(`❌ [DB] Error:`,t.message)}},storage:{operation:(e,t)=>{console.log(`📁 [STORAGE] ${e}`),t&&console.log(`📁 [STORAGE] Details:`,t)},initialized:(e,t)=>{console.log(`📁 [STORAGE] Initialized ${e} provider`),t&&console.log(`📁 [STORAGE] Path: ${t}`)},success:(e,t)=>{console.log(`✅ [STORAGE] ${e}`),t&&console.log(`📁 [STORAGE] Details:`,t)},error:(e,t)=>{console.error(`❌ [STORAGE] ${e}`),t&&console.error(`❌ [STORAGE] Error:`,t.message)}},openai:{start:e=>{console.log(`🤖 [OPENAI] ${e}`)},request:e=>{console.log(`🤖 [OPENAI] Sending request to OpenAI...`),e&&console.log(`🤖 [OPENAI] Request details:`,e)},response:e=>{console.log(`🤖 [OPENAI] Raw response content:`),console.log("---START RAW RESPONSE---"),console.log(e),console.log("---END RAW RESPONSE---")},success:e=>{console.log(`✅ [OPENAI] ${e}`)},error:(e,t)=>{console.log(`❌ [OPENAI] ${e}`),t&&console.error(`❌ [OPENAI] Error:`,t.message)}},extraction:{start:(e,t)=>{console.log(`[Extraction] Starting text extraction for document ${e}`),console.log(`[Extraction] Processing: ${t}`)},progress:(e,t)=>{console.log(`[Extraction] ${e}`),t&&console.log("[Extraction] Details:",t)},success:(e,t)=>{console.log(`[Extraction] Extracted ${t} characters`),console.log(`[Extraction] ✅ Completed for document ${e}`)},error:(e,t)=>{console.log(`[Extraction] ❌ Failed: ${t.message}`),console.error(`[Extraction] Error for document ${e}:`,t)}},queue:{operation:(e,t)=>{console.log(`[Queue] ${e}`),t&&console.log("[Queue] Details:",t)},task:(e,t,r)=>{console.log(`[Queue] ${e} task ${t}`),r&&console.log("[Queue] Task details:",r)}},info:(e,t)=>{console.log(`ℹ️ ${e}`),t&&console.log(`ℹ️ Context:`,t)},warn:(e,t)=>{console.warn(`⚠️ ${e}`),t&&console.warn(`⚠️ Context:`,t)},error:(e,t,r)=>{console.error(`❌ ${e}`),t&&(console.error(`❌ Error:`,t.message),a.Zt.isDevelopment()&&console.error(`❌ Stack:`,t.stack)),r&&console.error(`❌ Context:`,r)},debug:(e,t)=>{a.Zt.isDevelopment()&&(console.log(`🐛 [DEBUG] ${e}`),t&&console.log(`🐛 [DEBUG] Data:`,t))}}},22547:(e,t,r)=>{r.d(t,{Ai:()=>a,UI:()=>s,an:()=>o});var a=function(e){return e.UPLOADED="uploaded",e.PROCESSING="processing",e.PROCESSED="processed",e.ERROR="error",e}({}),s=function(e){return e.PENDING="pending",e.PROCESSING="processing",e.COMPLETED="completed",e.ERROR="error",e}({}),o=function(e){return e.QUEUED="queued",e.PROCESSING="processing",e.COMPLETED="completed",e.FAILED="failed",e}({})},27075:(e,t,r)=>{r.d(t,{wT:()=>E,o4:()=>R,FileValidation:()=>y,B7:()=>i,AF:()=>w,ff:()=>f,be:()=>g,ag:()=>v,k0:()=>n,LM:()=>S});var a=r(32190),s=r(81571),o=r(22547);o.Ai.UPLOADED,o.Ai.PROCESSING,o.Ai.ERROR,o.Ai.PROCESSING,o.Ai.PROCESSED,o.Ai.ERROR,o.Ai.PROCESSED,o.Ai.ERROR,o.Ai.PROCESSING,o.UI.PENDING,o.UI.PROCESSING,o.UI.ERROR,o.UI.PROCESSING,o.UI.COMPLETED,o.UI.ERROR,o.UI.COMPLETED,o.UI.ERROR,o.UI.PROCESSING;class i{static parseInteger(e,t={}){let{min:r=-1/0,max:a=1/0,fallback:s,fieldName:o="value"}=t;if(null==e)return void 0!==s?{isValid:!0,value:s}:{isValid:!1,value:0,error:`${o} is required`};let i="number"==typeof e?e:parseInt(String(e),10);if(isNaN(i))return void 0!==s?{isValid:!0,value:s}:{isValid:!1,value:0,error:`${o} must be a valid number`};let n=Math.max(r,Math.min(a,i));return{isValid:!0,value:n,sanitized:n!==i}}static parseFloat(e,t={}){let{min:r=-1/0,max:a=1/0,fallback:s,fieldName:o="value",precision:i}=t;if(null==e)return void 0!==s?{isValid:!0,value:s}:{isValid:!1,value:0,error:`${o} is required`};let n="number"==typeof e?e:parseFloat(String(e));if(isNaN(n))return void 0!==s?{isValid:!0,value:s}:{isValid:!1,value:0,error:`${o} must be a valid number`};let l=n;return void 0!==i&&(l=Math.round(n*Math.pow(10,i))/Math.pow(10,i)),{isValid:!0,value:l=Math.max(r,Math.min(a,l)),sanitized:l!==n}}static validateDocumentId(e,t="documentId"){return this.parseInteger(e,{min:1,fieldName:t,fallback:void 0})}static validatePagination(e){let t=[],r=t=>e instanceof URLSearchParams?e.get(t):e[t],a=this.parseInteger(r("page"),{min:1,max:1e3,fallback:1,fieldName:"page"}),s=this.parseInteger(r("pageSize"),{min:1,max:100,fallback:10,fieldName:"pageSize"});a.isValid||t.push(a.error),s.isValid||t.push(s.error);let o=a.value,i=s.value;return{page:o,pageSize:i,offset:(o-1)*i,isValid:0===t.length,errors:t}}static validateString(e,t={}){let{required:r=!1,minLength:a=0,maxLength:s=1/0,trim:o=!0,allowEmpty:i=!1,pattern:n,fieldName:l="value",fallback:u}=t;if(null==e)return void 0!==u?{isValid:!0,value:u}:r?{isValid:!1,value:"",error:`${l} is required`}:{isValid:!0,value:""};let c=o?String(e).trim():String(e),d=c!==String(e);if(!i&&0===c.length){if(void 0!==u)return{isValid:!0,value:u};if(r)return{isValid:!1,value:c,error:`${l} cannot be empty`}}return c.length<a?{isValid:!1,value:c,error:`${l} must be at least ${a} characters`}:(c.length>s&&(c=c.substring(0,s)),n&&!n.test(c))?{isValid:!1,value:c,error:`${l} format is invalid`}:{isValid:!0,value:c,sanitized:d||c.length>s}}static validateEmail(e,t={}){let{required:r=!1,allowEmpty:a=!1,fieldName:s="email"}=t,o=this.validateString(e,{required:r,allowEmpty:a,trim:!0,fieldName:s});if(!o.isValid)return{isValid:!1,value:o.value,error:o.error};let i=o.value;if(""===i&&a)return{isValid:!0,value:i};if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i))return{isValid:!1,value:i,error:`${s} must be a valid email address`};let[n,l]=i.split("@");return{isValid:!0,value:i.toLowerCase(),domain:l.toLowerCase(),localPart:n,sanitized:i!==i.toLowerCase()}}static validateBoolean(e,t={}){let{fieldName:r="value",fallback:a}=t;if(null==e)return void 0!==a?{isValid:!0,value:a}:{isValid:!1,value:!1,error:`${r} is required`};if("boolean"==typeof e)return{isValid:!0,value:e};if("string"==typeof e){let t=e.toLowerCase().trim();if(["true","1","yes","on"].includes(t))return{isValid:!0,value:!0,sanitized:!0};if(["false","0","no","off",""].includes(t))return{isValid:!0,value:!1,sanitized:!0}}return"number"==typeof e?{isValid:!0,value:!!e,sanitized:!0}:void 0!==a?{isValid:!0,value:a,sanitized:!0}:{isValid:!1,value:!1,error:`${r} must be a valid boolean value`}}static validateUrl(e,t={}){let{required:r=!1,allowedProtocols:a=["http","https"],fieldName:s="url"}=t,o=this.validateString(e,{required:r,trim:!0,fieldName:s});if(!o.isValid)return{isValid:!1,value:o.value,error:o.error};let i=o.value;if(""===i&&!r)return{isValid:!0,value:i};try{let e=new URL(i);if(!a.includes(e.protocol.replace(":","")))return{isValid:!1,value:i,error:`${s} must use one of: ${a.join(", ")}`};return{isValid:!0,value:e.toString()}}catch{return{isValid:!1,value:i,error:`${s} must be a valid URL`}}}static sanitizeHtml(e,t={}){let{allowedTags:r=[],stripTags:a=!0,fieldName:s="html"}=t;if(null==e)return{isValid:!0,value:""};let o=String(e);return a&&(o=o.replace(/<[^>]*>/g,"")),{isValid:!0,value:o=o.replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").replace(/<script[^>]*>.*?<\/script>/gi,""),sanitized:o!==String(e)}}static validateFileSize(e,t={}){let{maxSize:r=s.Eg.FILE_LIMITS.MAX_SIZE,fieldName:a="fileSize"}=t,o=this.parseInteger(e,{min:0,fieldName:a});return o.isValid?o.value>r?{isValid:!1,value:o.value,error:`${a} exceeds maximum allowed size of ${r} bytes`}:{isValid:!0,value:o.value}:o}static validateArray(e,t,r={}){let{minItems:a=0,maxItems:s=1/0,fieldName:o="array"}=r;if(!Array.isArray(e))return{isValid:!1,value:[],error:`${o} must be an array`};if(e.length<a)return{isValid:!1,value:[],error:`${o} must have at least ${a} items`};if(e.length>s)return{isValid:!1,value:[],error:`${o} cannot have more than ${s} items`};let i=[],n=[];for(let r=0;r<e.length;r++){let a=t(e[r],r);a.isValid?i.push(a.value):n.push(`Item ${r}: ${a.error}`)}return n.length>0?{isValid:!1,value:i,error:`${o} validation failed: ${n.join(", ")}`}:{isValid:!0,value:i}}}let n={documentId:e=>i.validateDocumentId(e),pagination:e=>i.validatePagination(e),email:e=>i.validateEmail(e,{required:!0}),requiredString:(e,t)=>i.validateString(e,{required:!0,fieldName:t}),optionalString:(e,t)=>i.validateString(e,{required:!1,fieldName:t}),booleanWithDefault:(e,t)=>i.validateBoolean(e,{fallback:t}),positiveInteger:(e,t)=>i.parseInteger(e,{min:1,fieldName:t}),nonNegativeInteger:(e,t)=>i.parseInteger(e,{min:0,fieldName:t})};class l{constructor(e,t={}){this.startTime=Date.now(),this.operationName=e,this.metadata=t}elapsed(){return Date.now()-this.startTime}elapsedFormatted(){return this.formatDuration(this.elapsed())}end(){let e=Date.now(),t=e-this.startTime;return{startTime:new Date(this.startTime),endTime:new Date(e),duration:t,durationMs:t,durationFormatted:this.formatDuration(t),operationName:this.operationName}}endWithLog(e={}){let t=this.end(),{logger:r,threshold:a=0,level:s="log"}=e;if(t.duration>=a){let e=`${this.operationName} completed in ${t.durationFormatted}`,a={duration:t.duration,startTime:t.startTime.toISOString(),endTime:t.endTime.toISOString(),...this.metadata};r?r[s](e,a):console[s](`[PERFORMANCE] ${e}`,a)}return t}formatDuration(e){return e<1e3?`${e}ms`:e<6e4?`${(e/1e3).toFixed(2)}s`:e<36e5?`${(e/6e4).toFixed(2)}m`:`${(e/36e5).toFixed(2)}h`}}let u={isFileNotFoundError:e=>e?.code==="ENOENT"||e?.code==="NoSuchKey"||e?.message?.includes("not found")||e?.statusCode===404,isDatabaseConnectionError:e=>e?.code==="ECONNREFUSED"||e?.code==="ER_CON_COUNT_ERROR"||e?.message?.includes("connection refused"),isDuplicateError:e=>e?.code==="ER_DUP_ENTRY"||e?.code==="23505"||e?.message?.includes("duplicate"),getErrorCategory(e){return this.isFileNotFoundError(e)?"not_found":this.isDatabaseConnectionError(e)?"connection":this.isDuplicateError(e)?"duplicate":e?.code==="AccessDenied"||e?.code==="Forbidden"?"permission":e?.code?.startsWith("ER_")||e?.name==="ValidationError"?"validation":"unknown"},getErrorSuggestion(e,t={}){let r=e.code||e.Code||"UNKNOWN_ERROR",a=e.statusCode||e.$metadata?.httpStatusCode;switch(r){case"NoSuchBucket":return{userMessage:"Storage bucket not found",errorCode:"STORAGE_BUCKET_NOT_FOUND",isRetryable:!1,suggestion:"Please check your storage configuration and bucket name."};case"AccessDenied":case"Forbidden":return{userMessage:"Storage access denied",errorCode:"STORAGE_ACCESS_DENIED",isRetryable:!1,suggestion:"Please check your storage credentials and bucket permissions."};case"NoSuchKey":return{userMessage:t.resource?`File '${t.resource}' not found in storage`:"File not found in storage",errorCode:"STORAGE_FILE_NOT_FOUND",isRetryable:!1,suggestion:"The requested file may have been moved or deleted."};case"InvalidBucketName":return{userMessage:"Invalid storage bucket name",errorCode:"STORAGE_INVALID_BUCKET",isRetryable:!1,suggestion:"Please check your storage configuration for valid bucket naming."};case"SlowDown":case"RequestLimitExceeded":case"TooManyRequests":return{userMessage:"Storage service is being throttled",errorCode:"STORAGE_THROTTLED",isRetryable:!0,suggestion:"Please wait a moment and try again. The service is experiencing high load."};case"ServiceUnavailable":return{userMessage:"Storage service temporarily unavailable",errorCode:"STORAGE_SERVICE_UNAVAILABLE",isRetryable:!0,suggestion:"The storage service is temporarily down. Please try again in a few minutes."};case"RequestTimeout":return{userMessage:"Storage operation timed out",errorCode:"STORAGE_TIMEOUT",isRetryable:!0,suggestion:"The operation took too long to complete. Please try again."};case"ENOSPC":return{userMessage:"Insufficient storage space",errorCode:"STORAGE_QUOTA_EXCEEDED",isRetryable:!1,suggestion:"Please free up storage space or contact your administrator."};case"ENOENT":return{userMessage:"File or directory not found",errorCode:"STORAGE_PATH_NOT_FOUND",isRetryable:!1,suggestion:"The file path may be incorrect or the file may have been moved."};case"ECONNREFUSED":return{userMessage:"Cannot connect to storage service",errorCode:"STORAGE_CONNECTION_REFUSED",isRetryable:!0,suggestion:"Please check your network connection and storage service configuration."};case"ETIMEDOUT":return{userMessage:"Connection to storage service timed out",errorCode:"STORAGE_CONNECTION_TIMEOUT",isRetryable:!0,suggestion:"Please check your network connection and try again."};case"ENOTFOUND":return{userMessage:"Storage service not found",errorCode:"STORAGE_SERVICE_NOT_FOUND",isRetryable:!0,suggestion:"Please check your storage service configuration and DNS settings."};default:if(a){if(a>=500&&a<600)return{userMessage:"Storage service error",errorCode:"STORAGE_SERVER_ERROR",isRetryable:!0,suggestion:"A server error occurred. Please try again in a few moments."};if(a>=400&&a<500)return{userMessage:"Storage request error",errorCode:"STORAGE_CLIENT_ERROR",isRetryable:!1,suggestion:"Please check your request parameters and try again."}}return{userMessage:t.operation?`${t.operation} operation failed`:"Storage operation failed",errorCode:"STORAGE_UNKNOWN_ERROR",isRetryable:!1,suggestion:"An unexpected error occurred. Please try again or contact support."}}},isRetryableError(e){return this.getErrorSuggestion(e).isRetryable},getUserMessage(e,t={}){return this.getErrorSuggestion(e,t).userMessage},getErrorCode(e){return this.getErrorSuggestion(e).errorCode},getSuggestion(e,t={}){return this.getErrorSuggestion(e,t).suggestion}},c={storage:{maxAttempts:3,initialDelay:1e3,maxDelay:1e4,backoffFactor:2,jitter:!0,timeout:3e4},api:{maxAttempts:3,initialDelay:500,maxDelay:5e3,backoffFactor:2,jitter:!0,timeout:15e3},database:{maxAttempts:5,initialDelay:100,maxDelay:2e3,backoffFactor:1.5,jitter:!1,timeout:1e4},queue:{maxAttempts:3,initialDelay:2e3,maxDelay:3e4,backoffFactor:2,jitter:!0,timeout:6e4},network:{maxAttempts:5,initialDelay:1e3,maxDelay:8e3,backoffFactor:2,jitter:!0,timeout:2e4}};class d{constructor(e=5,t=6e4){this.failureThreshold=e,this.recoveryTimeout=t,this.failures=0,this.lastFailureTime=0,this.state="closed"}canExecute(){return"closed"===this.state||"open"!==this.state||Date.now()-this.lastFailureTime>this.recoveryTimeout&&(this.state="half-open",!0)}onSuccess(){this.failures=0,this.state="closed"}onFailure(){this.failures++,this.lastFailureTime=Date.now(),this.failures>=this.failureThreshold&&(this.state="open")}getState(){return this.state}}class g{static{this.circuitBreakers=new Map}static async withRetry(e,t={}){let{maxAttempts:r=3,initialDelay:a=1e3,maxDelay:s=1e4,backoffFactor:o=2,jitter:i=!0,timeout:n,retryCondition:u=this.defaultRetryCondition,onRetry:c,onFailure:d,abortSignal:g}=t,m=new l("retry-operation"),p=[],f=0;for(;f<r;){f++;try{if(g?.aborted)throw Error("Operation aborted");let t=n?await this.withTimeout(e(),n):await e(),r=m.end();return{result:t,attempts:f,totalDuration:r.duration,errors:p,wasRetried:f>1}}catch(l){let e=l instanceof Error?l:Error(String(l));if(p.push(e),f>=r||!u(e,f)){let t=m.end();throw d&&d(e,f,t.duration),Error(`Operation failed after ${f} attempts in ${t.durationFormatted}. Last error: ${e.message}`)}let t=Math.min(a*Math.pow(o,f-1),s),n=i?t+Math.random()*t*.1:t;c&&c(e,f,n),await this.delay(n)}}throw Error("Unexpected retry loop exit")}static defaultRetryCondition(e,t){return u.isRetryableError(e)}static async withCircuitBreaker(e,t,r={}){let a=this.getCircuitBreaker(t);if(!a.canExecute())throw Error(`Circuit breaker is open for ${t}`);try{let t=await this.withRetry(e,r);return a.onSuccess(),t}catch(e){throw a.onFailure(),e}}static getCircuitBreaker(e){return this.circuitBreakers.has(e)||this.circuitBreakers.set(e,new d),this.circuitBreakers.get(e)}static async forStorage(e,t,r={}){return this.withRetry(e,{...c.storage,...r,onRetry:(e,a,s)=>{console.log(`Storage ${t} failed (attempt ${a}), retrying in ${s}ms:`,e.message),r.onRetry?.(e,a,s)},onFailure:(e,a,s)=>{console.error(`Storage ${t} failed permanently after ${a} attempts in ${s}ms:`,e),r.onFailure?.(e,a,s)}})}static async forApi(e,t,r={}){return this.withRetry(e,{...c.api,...r,retryCondition:(e,t)=>e.status>=400&&e.status<500?408===e.status||429===e.status:this.defaultRetryCondition(e,t),onRetry:(e,a,s)=>{console.log(`API ${t} failed (attempt ${a}), retrying in ${s}ms:`,e.message),r.onRetry?.(e,a,s)}})}static async forDatabase(e,t,r={}){return this.withRetry(e,{...c.database,...r,retryCondition:(e,t)=>{let r=e.message?.toLowerCase()||"";return!!(r.includes("connection")||r.includes("timeout")||r.includes("deadlock"))||this.defaultRetryCondition(e,t)},onRetry:(e,a,s)=>{console.log(`Database ${t} failed (attempt ${a}), retrying in ${s}ms:`,e.message),r.onRetry?.(e,a,s)}})}static async forQueue(e,t,r={}){return this.withRetry(e,{...c.queue,...r,onRetry:(e,a,s)=>{console.log(`Queue ${t} failed (attempt ${a}), retrying in ${s}ms:`,e.message),r.onRetry?.(e,a,s)}})}static async withConfig(e,t,r={}){return this.withRetry(e,{...c[t],...r})}static withTimeout(e,t){return new Promise((r,a)=>{let s=setTimeout(()=>{a(Error(`Operation timed out after ${t}ms`))},t);e.then(r).catch(a).finally(()=>clearTimeout(s))})}static delay(e){return new Promise(t=>setTimeout(t,e))}static async retryAll(e,t={}){return Promise.all(e.map(e=>this.withRetry(e,t)))}static async withRateLimit(e,t,r={}){return this.withRetry(e,{...r,retryCondition:(e,t)=>e.message?.includes("rate limit")?t<(r.maxAttempts||5):r.retryCondition?.(e,t)??this.defaultRetryCondition(e,t)})}static getCircuitBreakerStatus(e){let t=this.circuitBreakers.get(e);return t?.getState()||"unknown"}static resetCircuitBreaker(e){this.circuitBreakers.delete(e)}static getAllCircuitBreakerStatuses(){let e={};for(let[t,r]of this.circuitBreakers)e[t]=r.getState();return e}}class m{static sanitize(e){let t=R.getMessage(e),r=R.getCode(e);return{message:t.replace(/password[=:]\s*[^\s]+/gi,"password=***").replace(/token[=:]\s*[^\s]+/gi,"token=***").replace(/key[=:]\s*[^\s]+/gi,"key=***"),code:r,timestamp:v.now(),sanitized:!0}}static toUserMessage(e){return R.isError(e)?"An error occurred. Please try again.":"An unexpected error occurred."}static normalizeError(e){return R.isError(e)?e:Error("string"==typeof e?e:"Unknown error")}}m.sanitize,m.normalizeError,m.toUserMessage;let p={success:200,created:201,updated:200,deleted:200,queued:202,processing:202,completed:200,failed:500,partial:206,pending:202,cancelled:200,error:500};class f{static success(e={}){return this.buildResponse({...e,status:e.status||"success"})}static created(e,t={}){return this.buildResponse({...t,data:e,status:"created",message:t.message||"Resource created successfully"})}static updated(e,t={}){return this.buildResponse({...t,data:e,status:"updated",message:t.message||"Resource updated successfully"})}static deleted(e={}){return this.buildResponse({...e,status:"deleted",message:e.message||"Resource deleted successfully"})}static list(e,t,r={}){let a={...r,data:e,metadata:{count:e.length,...r.metadata}};return t&&(a.pagination={...t,totalPages:Math.ceil(t.total/t.pageSize)}),this.buildResponse(a)}static queued(e,t={}){return this.buildResponse({...t,data:e,status:"queued",httpStatus:202,message:t.message||"Request queued for processing"})}static processing(e,t={}){return this.buildResponse({...t,data:e,status:"processing",httpStatus:202,message:t.message||"Request is being processed"})}static partial(e,t,r={}){return this.buildResponse({...r,data:e,warnings:t,status:"partial",httpStatus:206,message:r.message||"Request completed with warnings"})}static operation(e,t={}){return this.buildResponse({...t,operation:e,message:t.message||this.getOperationMessage(e,t.status||"success")})}static error(e){let{message:t="An error occurred",code:r="INTERNAL_ERROR",statusCode:s=500,details:o,suggestion:i,context:n,operation:l}=e,u={success:!1,status:"error",message:t,timestamp:v.now(),errors:[t],metadata:{code:r,...i&&{suggestion:i},...n&&{context:n},...o&&{details:o}}};return l&&(u.operation=l),a.NextResponse.json(u,{status:s})}static validationError(e,t=[],r={}){return this.error({...r,message:e,code:"VALIDATION_ERROR",statusCode:400,details:{validationErrors:t}})}static notFound(e="Resource",t={}){return this.error({...t,message:t.message||`${e} not found`,code:"NOT_FOUND",statusCode:404})}static unauthorized(e="Unauthorized",t={}){return this.error({...t,message:e,code:"UNAUTHORIZED",statusCode:401})}static forbidden(e="Forbidden",t={}){return this.error({...t,message:e,code:"FORBIDDEN",statusCode:403})}static serverError(e="Internal server error",t={}){return this.error({...t,message:e,code:"INTERNAL_ERROR",statusCode:500})}static file(e,t={}){let{filename:r,contentType:s="application/octet-stream",disposition:o="attachment",cacheControl:i,lastModified:n,etag:l}=t,u={"Content-Type":s};r&&(u["Content-Disposition"]=`${o}; filename="${r}"`),i&&(u["Cache-Control"]=i),n&&(u["Last-Modified"]=n.toUTCString()),l&&(u.ETag=l);let c=e instanceof Buffer?new Uint8Array(e):e;return new a.NextResponse(c,{headers:u})}static redirect(e,t=!1){return a.NextResponse.redirect(e,{status:t?301:302})}static noContent(){return new a.NextResponse(null,{status:204})}static withHeaders(e,t){return Object.entries(t).forEach(([t,r])=>{e.headers.set(t,r)}),e}static buildResponse(e){let{data:t,message:r,status:s="success",httpStatus:o,metadata:i={},warnings:n=[],errors:l=[],operation:u,timing:c,headers:d={},pagination:g}=e,m={success:!0,timestamp:v.now()};if(u&&(m.operation=u),m.status=s,r&&(m.message=r),void 0!==t&&(m.data=t),Object.keys(i).length>0&&(m.metadata=i),g&&(m.pagination={...g,totalPages:Math.ceil(g.total/g.pageSize)}),n.length>0&&(m.warnings=n),l.length>0&&(m.errors=l),c){let e=Date.now()-c.start;m.timing={duration:`${e}ms`,operations:c.operations}}let f=o||p[s]||200,h=a.NextResponse.json(m,{status:f});return Object.entries(d).forEach(([e,t])=>{h.headers.set(e,t)}),h}static getOperationMessage(e,t){let[r,a]=e.split("."),s={document:{success:"Document operation completed successfully",created:"Document uploaded successfully",updated:"Document updated successfully",deleted:"Document deleted successfully",queued:"Document processing queued",processing:"Document is being processed",completed:"Document processing completed"},comparison:{success:"Comparison completed successfully",created:"Comparison created successfully",updated:"Comparison updated successfully",completed:"Document comparison completed",processing:"Documents are being compared",queued:"Comparison queued for processing"},queue:{success:"Queue operation completed successfully",processing:"Task is being processed",completed:"Task completed successfully",failed:"Task failed to complete",queued:"Task queued for processing"},extraction:{success:"Text extraction completed successfully",queued:"Text extraction queued",processing:"Text is being extracted",completed:"Text extraction completed"},upload:{success:"File uploaded successfully",created:"File uploaded and saved",processing:"File is being processed"},health:{success:"Health check passed",partial:"Service partially healthy",failed:"Health check failed"}};return s[r]?.[t]||s[r]?.success||`${r} ${a} ${t}`}}r(2591);class h{static convertBaseRow(e){return{...e,created_at:"string"==typeof e.created_at?new Date(e.created_at):e.created_at,updated_at:"string"==typeof e.updated_at?new Date(e.updated_at):e.updated_at}}static convertDocument(e){return{...h.convertBaseRow(e),metadata:w.parseMetadata(e.metadata),file_size:Number(e.file_size),is_standard:!!e.is_standard}}static convertComparison(e){return{...h.convertBaseRow(e),metadata:w.parseMetadata(e.metadata),differences:w.parseMetadata(e.differences),risk_score:Number(e.risk_score),document_id:Number(e.document_id),standard_id:e.standard_id?Number(e.standard_id):null}}static convertExport(e){return{...h.convertBaseRow(e),metadata:w.parseMetadata(e.metadata),comparison_id:Number(e.comparison_id)}}static convertQueue(e){return{...h.convertBaseRow(e),metadata:w.parseMetadata(e.metadata),document_id:Number(e.document_id),priority:Number(e.priority),attempts:Number(e.attempts),max_attempts:Number(e.max_attempts),scheduled_at:e.scheduled_at?"string"==typeof e.scheduled_at?new Date(e.scheduled_at):e.scheduled_at:null,started_at:e.started_at?"string"==typeof e.started_at?new Date(e.started_at):e.started_at:null,completed_at:e.completed_at?"string"==typeof e.completed_at?new Date(e.completed_at):e.completed_at:null,failed_at:e.failed_at?"string"==typeof e.failed_at?new Date(e.failed_at):e.failed_at:null}}}h.convertDocument,h.convertComparison,h.convertExport,h.convertQueue,(e,t)=>e.map(t);let E={unauthorized:()=>a.NextResponse.json({error:s.Eg.MESSAGES.UNAUTHORIZED},{status:401}),notFound:e=>a.NextResponse.json({error:`${e} not found`},{status:404}),badRequest:e=>a.NextResponse.json({error:e},{status:400}),serverError:(e,t)=>a.NextResponse.json({error:e||s.Eg.MESSAGES.INTERNAL_ERROR,...t&&{details:t}},{status:500}),forbidden:(e="Access denied")=>a.NextResponse.json({error:e},{status:403}),conflict:e=>a.NextResponse.json({error:e},{status:409}),validation:(e,t)=>a.NextResponse.json({error:e,details:t},{status:422}),rateLimitExceeded:e=>{let t={"Retry-After":e?Math.ceil((e.getTime()-Date.now())/1e3).toString():"3600"};return a.NextResponse.json({error:"Rate limit exceeded",message:"Rate limit exceeded",resetTime:e?.toISOString()},{status:429,headers:t})},processingError:(e,t)=>a.NextResponse.json({error:"Processing failed",operation:e,details:t,message:`Failed to process ${e}`},{status:422}),configurationError:e=>a.NextResponse.json({error:"Configuration error",missing:e,message:"Configuration error"},{status:503})},R={isError:e=>e instanceof Error||e&&"object"==typeof e&&"message"in e&&"name"in e,getMessage:e=>"string"==typeof e?e:R.isError(e)?e.message:e?.error?R.getMessage(e.error):e?.message?e.message:"Unknown error occurred",getCode:e=>e?.code||e?.errorCode||e?.error_code,withContext:(e,t)=>{let r=Error(e);return Object.assign(r,{context:t}),r},isType:(e,t)=>e?.name===t||e?.constructor?.name===t,is:{networkError:e=>{let t=R.getMessage(e).toLowerCase();return t.includes("network")||t.includes("fetch")||t.includes("connection")},validationError:e=>{let t=R.getMessage(e).toLowerCase();return t.includes("validation")||t.includes("invalid")||e?.statusCode===422},authError:e=>{let t=R.getMessage(e).toLowerCase();return t.includes("unauthorized")||t.includes("authentication")||e?.statusCode===401},notFoundError:e=>R.getMessage(e).toLowerCase().includes("not found")||e?.statusCode===404}};function S(e,t){return e.user_id===t}let y={allowedTypes:[...s.Eg.FILE_LIMITS.ALLOWED_MIME_TYPES],allowedExtensions:s.Eg.FILE_LIMITS.ALLOWED_EXTENSIONS,maxSize:s.Eg.FILE_LIMITS.MAX_SIZE,extensionToMimeType:{".pdf":"application/pdf",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".doc":"application/msword",".txt":"text/plain",".csv":"text/csv"},validateFile:e=>{if(!y.allowedTypes.includes(e.type))throw Error(`Invalid file type. Only ${y.allowedExtensions.join(", ").toUpperCase()} files are allowed. Received: ${e.type}`);if(e.size>y.maxSize)throw Error(`File too large. Maximum size is ${y.maxSize/1024/1024}MB. Received: ${(e.size/1024/1024).toFixed(2)}MB`);return!0},getValidationError:e=>{try{return y.validateFile(e),null}catch(t){if(t.message.includes("Invalid file type"))return E.validation("Invalid file type",{allowedTypes:y.allowedExtensions,receivedType:e.type});if(t.message.includes("File too large"))return E.validation("File too large",{maxSize:y.maxSize,actualSize:e.size,maxSizeMB:y.maxSize/1024/1024,actualSizeMB:Number((e.size/1024/1024).toFixed(2))});return E.badRequest(t.message)}},getContentType:e=>{let t=e.toLowerCase().split(".").pop()||"";return y.extensionToMimeType[t]||"application/octet-stream"}},v={now:()=>new Date().toISOString(),nowUTC:()=>new Date().toISOString(),formatForDB:(e=new Date)=>e.toISOString(),formatForLog:(e=new Date)=>e.toISOString(),formatForAPI:(e=new Date)=>e.toISOString(),createTimestamp:()=>({createdAt:v.now()}),updateTimestamp:()=>({updatedAt:v.now()}),auditTimestamp:()=>({createdAt:v.now(),updatedAt:v.now()}),withMetadata:e=>({timestamp:v.now(),...e}),parse:e=>e instanceof Date?e:new Date(e),isRecent:(e,t=5)=>{let r=v.parse(e);return(new Date().getTime()-r.getTime())/6e4<=t},formatHuman:(e=new Date,t="en-US")=>e.toLocaleString(t),toLocaleDateString:(e,t="en-US")=>new Date(e).toLocaleDateString(t,{year:"numeric",month:"short",day:"numeric"}),toLocaleString:(e,t="en-US")=>new Date(e).toLocaleString(t),fromNow:e=>{let t=Math.floor((Date.now()-new Date(e).getTime())/864e5);return 0===t?"Today":1===t?"Yesterday":t<7?`${t} days ago`:t<30?`${Math.floor(t/7)} weeks ago`:v.toLocaleDateString(e)},isExpired:e=>new Date(e).getTime()<Date.now(),formatForFilename:(e=new Date)=>e.toISOString().replace(/[:.]/g,"-").split(".")[0],duration:{seconds:(e,t=new Date)=>{let r=v.parse(e);return Math.floor((v.parse(t).getTime()-r.getTime())/1e3)},minutes:(e,t=new Date)=>Math.floor(v.duration.seconds(e,t)/60),milliseconds:(e,t=new Date)=>{let r=v.parse(e);return v.parse(t).getTime()-r.getTime()},humanReadable:(e,t=new Date)=>{let r=v.duration.milliseconds(e,t);return r<1e3?`${r}ms`:r<6e4?`${(r/1e3).toFixed(1)}s`:r<36e5?`${(r/6e4).toFixed(1)}m`:`${(r/36e5).toFixed(1)}h`}},relative:{from:(e,t=new Date)=>{let r=v.parse(e),a=t.getTime()-r.getTime();return a<6e4?"just now":a<36e5?`${Math.floor(a/6e4)} minutes ago`:a<864e5?`${Math.floor(a/36e5)} hours ago`:a<6048e5?`${Math.floor(a/864e5)} days ago`:r.toLocaleDateString()},to:(e,t=new Date)=>{let r=v.parse(e),a=r.getTime()-t.getTime();return a<0?v.relative.from(e,t):a<6e4?"in a moment":a<36e5?`in ${Math.floor(a/6e4)} minutes`:a<864e5?`in ${Math.floor(a/36e5)} hours`:a<6048e5?`in ${Math.floor(a/864e5)} days`:r.toLocaleDateString()}}},w={safeParse:(e,t)=>{if(!e)return t;try{return JSON.parse(e)}catch{return t}},parseMetadata:e=>e?"string"==typeof e?w.safeParse(e,{}):e:{},mergeMetadata:(e,t)=>({...w.parseMetadata(e),...t,lastUpdated:new Date().toISOString()}),stringify:(e,t=!1)=>{try{return t?JSON.stringify(e,null,2):JSON.stringify(e)}catch(e){return console.error("JSON stringify error:",e),"{}"}},deepClone:e=>JSON.parse(JSON.stringify(e)),isValidJson:e=>{try{return JSON.parse(e),!0}catch{return!1}},extractFields:(e,t)=>{let r=w.parseMetadata(e),a={};return t.forEach(e=>{e in r&&(a[e]=r[e])}),a},metadata:{withTimestamp:e=>({...e,timestamp:new Date().toISOString()}),withUser:(e,t)=>({...e,userEmail:t,updatedBy:t,updatedAt:new Date().toISOString()}),withError:(e,t)=>({...e,error:{message:t.message,name:t.name,timestamp:new Date().toISOString()}})},getNestedValue:(e,t,r)=>{if(!e)return r;let a=t.split("."),s=e;for(let e of a){if(s?.[e]===void 0)return r;s=s[e]}return s},getExtractionMetadata:e=>({pages:w.getNestedValue(e,"extraction.pages",null),confidence:w.getNestedValue(e,"extraction.confidence",null),method:w.getNestedValue(e,"extraction.method","unknown"),extractedAt:w.getNestedValue(e,"extraction.extractedAt",null)})}},77718:(e,t,r)=>{r.d(t,{ru:()=>c});var a=r(32190),s=r(61120),o=r(35426),i=r(76809),n=r(39916);new Date(Date.now()+864e5).toISOString();let l=(0,s.cache)(async()=>{let e=await (0,o.getServerSession)(i.N);return e||(0,n.redirect)("/sign-in"),e}),u=(0,s.cache)(async()=>await (0,o.getServerSession)(i.N));function c(e){return async t=>{let r=await u();return r?.user?.email?e(t,r.user.email):a.NextResponse.json({error:"Authentication required"},{status:401})}}(0,s.cache)(async()=>{let e=await l();return e.user?.email||""}),(0,s.cache)(async()=>!!await u()),r(27075),r(2591),r(81571)}};